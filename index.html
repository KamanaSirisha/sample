<!DOCTYPE html>
<html>
<head>
  <title>Student Earnings Website</title>
  <style>
    :root {
      --primary-bg: linear-gradient(135deg, #A0C4FF, #FFD1DC);
      --header-bg: #4A4E69;
      --container-bg: #F8F1E9;
      --button-bg: #FF9999;
      --button-hover: #FF6666;
      --text-color: #333333;
      --accent-color: #B5EAD7;
      --shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      --border-radius: 10px;
      --transition: all 0.3s ease;
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: var(--primary-bg);
      margin: 0;
      padding: 0;
      color: var(--text-color);
      line-height: 1.6;
    }

    header {
      background: var(--header-bg);
      color: white;
      text-align: center;
      padding: 20px;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 1px;
      box-shadow: var(--shadow);
    }

    .container {
      max-width: 600px;
      margin: 30px auto;
      background: var(--container-bg);
      padding: 30px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      transition: var(--transition);
      transform: translateY(0);
    }

    .container:hover {
      transform: translateY(-5px);
    }

    h2 {
      color: var(--header-bg);
      font-size: 24px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 500;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 500;
      color: var(--text-color);
    }

    input, select {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border: 1px solid #e0e0e0;
      border-radius: var(--border-radius);
      font-size: 16px;
      transition: var(--transition);
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 5px rgba(181, 234, 215, 0.3);
    }

    button {
      background: var(--button-bg);
      color: white;
      border: none;
      padding: 12px;
      width: 100%;
      margin-top: 20px;
      border-radius: var(--border-radius);
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }

    button:hover {
      background: var(--button-hover);
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    .alert-box {
      margin-top: 20px;
      background: #F0FAF7;
      padding: 20px;
      border: 1px solid var(--accent-color);
      border-radius: var(--border-radius);
      animation: fadeIn 0.5s ease-in;
    }

    /* Pop-up Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: var(--container-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      text-align: center;
      max-width: 400px;
      width: 90%;
      animation: slideIn 0.3s ease-out;
    }

    .modal-content h3 {
      color: var(--header-bg);
      margin: 0 0 15px;
    }

    .modal-content button {
      width: auto;
      padding: 10px 20px;
      margin-top: 10px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }

    @media (max-width: 600px) {
      .container {
        margin: 20px;
        padding: 20px;
      }

      header {
        font-size: 24px;
        padding: 15px;
      }

      .modal-content {
        width: 80%;
      }
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>Welcome to Student Earnings Website</header>

  <!-- Welcome Pop-up Modal -->
  <div class="modal" id="welcomeModal">
    <div class="modal-content">
      <h3>Welcome ðŸ¤—</h3>
      <p>Explore opportunities to earn or find services tailored for students!</p>
      <button onclick="closeModal('welcomeModal')">Get Started</button>
    </div>
  </div>

  <!-- Farewell Pop-up Modal -->
  <div class="modal" id="farewellModal">
    <div class="modal-content">
      <h3>Thank You!</h3>
      <p>Thank you for reaching us! Come back soon! ðŸ˜Š</p>
      <button onclick="closeModal('farewellModal')">Close</button>
    </div>
  </div>

  <!-- Welcome Section -->
  <div class="container" id="welcomeSection">
    <h2>Choose Your Role</h2>
    <button type="button" onclick="showWorkerSignup()">Register as a Worker</button>
    <button type="button" onclick="showCustomerSignup()">Register as a Customer</button>
  </div>

  <!-- Worker Signup Section -->
  <div class="container" id="workerSignupSection" style="display:none;">
    <h2>Worker Registration</h2>
    <form onsubmit="return false;">
      <label for="workerName">Full Name:</label>
      <input type="text" id="workerName" placeholder="Enter your name" required>

      <label for="workerEmail">Email ID:</label>
      <input type="email" id="workerEmail" placeholder="Enter email" required>

      <label for="workerPassword">Password:</label>
      <input type="password" id="workerPassword" placeholder="Create password" required>

      <label for="workerAge">Age:</label>
      <input type="number" id="workerAge" placeholder="Enter your age" required>

      <label for="workerEducation">Education Level:</label>
      <select id="workerEducation" required>
        <option value="">-- Select Education --</option>
        <option value="below_10">Below 10th</option>
        <option value="10_pass">10th Pass</option>
        <option value="12_pass">10+2 Pass</option>
        <option value="graduate">Graduate</option>
        <option value="postgraduate">Postgraduate</option>
      </select>

      <label for="workerIdProof">ID Proof:</label>
      <input type="file" id="workerIdProof" accept=".pdf,.jpg,.png" required>

      <label for="workerResume">Upload Resume:</label>
      <input type="file" id="workerResume" accept=".pdf" required>

      <label for="workerContact">Contact Information:</label>
      <input type="text" id="workerContact" placeholder="Enter your phone number" required>

      <button type="button" onclick="submitWorker()">Next â†’</button>
      <button type="button" onclick="showFarewellModal('workerSignupSection', 'welcomeSection')">â¬… Back</button>
    </form>
  </div>

  <!-- Worker Skills Section -->
  <div class="container" id="workerSkillsSection" style="display:none;">
    <h2>Select Your Skills</h2>
    <form onsubmit="return false;">
      <label for="workerSkillCategory">Select Skill Category:</label>
      <select id="workerSkillCategory" onchange="showWorkerSubOptions()">
        <option value="">-- Choose Category --</option>
        <option value="teaching">Teaching</option>
        <option value="parttime">Part-Time Jobs</option>
        <option value="events">Event Management</option>
      </select>

      <div id="workerSubOptions" style="margin-top:15px;"></div>

      <button type="button" onclick="submitWorkerSkills()">Submit â†’</button>
      <button type="button" onclick="showFarewellModal('workerSkillsSection', 'workerSignupSection')">â¬… Back</button>
    </form>
  </div>

  <!-- Customer Signup Section -->
  <div class="container" id="customerSignupSection" style="display:none;">
    <h2>Customer Registration</h2>
    <form onsubmit="return false;">
      <label for="customerName">Full Name:</label>
      <input type="text" id="customerName" placeholder="Enter your name" required>

      <label for="customerEmail">Email ID:</label>
      <input type="email" id="customerEmail" placeholder="Enter email" required>

      <label for="customerAge">Age:</label>
      <input type="number" id="customerAge" placeholder="Enter your age" required>

      <label for="customerContact">Contact Information:</label>
      <input type="text" id="customerContact" placeholder="Enter your phone number" required>

      <button type="button" onclick="submitCustomer()">Next â†’</button>
      <button type="button" onclick="showFarewellModal('customerSignupSection', 'welcomeSection')">â¬… Back</button>
    </form>
  </div>

  <!-- Customer Services Section -->
  <div class="container" id="customerServicesSection" style="display:none;">
    <h2>Select Services You Want</h2>
    <form onsubmit="return false;">
      <label for="customerServiceCategory">Select Service Category:</label>
      <select id="customerServiceCategory" onchange="showCustomerSubOptions()">
        <option value="">-- Choose Category --</option>
        <option value="teaching">Teaching</option>
        <option value="parttime">Part-Time Jobs</option>
        <option value="events">Event Management</option>
      </select>

      <div id="customerSubOptions" style="margin-top:15px;"></div>

      <button type="button" onclick="submitCustomerServices()">Submit â†’</button>
      <button type="button" onclick="showFarewellModal('customerServicesSection', 'customerSignupSection')">â¬… Back</button>
    </form>
  </div>

  <!-- Alerts Section -->
  <div class="container" id="alertSection" style="display:none;">
    <h2>Registration Status</h2>
    <div id="alerts"></div>
    <button type="button" onclick="showFarewellModal('alertSection', 'welcomeSection')">â¬… Back to Welcome</button>
  </div>

  <script>
    let userEmail = "";
    let selectedCategory = "";
    let selectedSub = "";

    // Show welcome modal on page load
    window.onload = function() {
      document.getElementById('welcomeModal').style.display = 'flex';
    };

    // Handle beforeunload event for farewell message
    window.addEventListener('beforeunload', function(e) {
      document.getElementById('farewellModal').style.display = 'flex';
      e.preventDefault();
      e.returnValue = ''; // Trigger browser's default confirmation dialog
    });

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    function showFarewellModal(currentSection, nextSection) {
      document.getElementById('farewellModal').style.display = 'flex';
      // Delay navigation to allow modal to be seen
      setTimeout(() => {
        document.getElementById(currentSection).style.display = 'none';
        document.getElementById(nextSection).style.display = 'block';
        document.getElementById('farewellModal').style.display = 'none';
      }, 1000); // 1-second delay for visibility
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function validateContact(contact) {
      const re = /^\d{10}$/;
      return re.test(contact);
    }

    function validateFile(fileInput, acceptTypes) {
      const file = fileInput.files[0];
      if (!file) return false;
      const maxSize = 5 * 1024 * 1024; // 5MB
      if (file.size > maxSize) {
        alert("File size must be less than 5MB.");
        return;
      }
      return acceptTypes.includes(file.type);
    }

    function showWorkerSignup() {
      document.getElementById('welcomeSection').style.display = 'none';
      document.getElementById('workerSignupSection').style.display = 'block';
    }

    function showCustomerSignup() {
      document.getElementById('welcomeSection').style.display = 'none';
      document.getElementById('customerSignupSection').style.display = 'block';
    }

    function submitWorker() {
      userEmail = document.getElementById('workerEmail').value;
      const name = document.getElementById('workerName').value;
      const contact = document.getElementById('workerContact').value;
      const age = document.getElementById('workerAge').value;
      const education = document.getElementById('workerEducation').value;
      const idProof = document.getElementById('workerIdProof');
      const resume = document.getElementById('workerResume');
      const password = document.getElementById('workerPassword').value;

      if (!userEmail || !name || !contact || !age || !education || !password) {
        alert("Please fill in all required fields.");
        return;
      }

      if (!validateEmail(userEmail)) {
        alert("Please enter a valid email address.");
        return;
      }

      if (!validateContact(contact)) {
        alert("Please enter a valid 10-digit phone number.");
        return;
      }

      if (parseInt(age) < 18) {
        alert("You must be at least 18 years old to register as a worker.");
        return;
      }

      if (education === "below_10" || education === "10_pass") {
        alert("You must have completed at least 10+2 education to register as a worker.");
        return;
      }

      if (!validateFile(idProof, ['application/pdf', 'image/jpeg', 'image/png'])) {
        alert("Please upload a valid ID proof (PDF, JPG, or PNG).");
        return;
      }

      if (!validateFile(resume, ['application/pdf'])) {
        alert("Please upload a valid resume (PDF only).");
        return;
      }

      if (password.length < 8) {
        alert("Password must be at least 8 characters long.");
        return;
      }

      document.getElementById('workerSignupSection').style.display = 'none';
      document.getElementById('workerSkillsSection').style.display = 'block';
    }

    function showWorkerSubOptions() {
      const category = document.getElementById('workerSkillCategory').value;
      let options = "";

      if (category === "teaching") {
        options = `
          <label for="workerSubSkill">Select Subject:</label>
          <select id="workerSubSkill">
            <option>Biology</option>
            <option>Physics</option>
            <option>Chemistry</option>
            <option>Story Teller</option>
            <option>Maths</option>
            <option>Aptitude</option>
            <option>English</option>
            <option>History</option>
          </select>
        `;
      } else if (category === "parttime") {
        options = `
          <label for="workerSubSkill">Select Job Type:</label>
          <select id="workerSubSkill">
            <option>Delivery Boy</option>
            <option>Mehndi Designer</option>
            <option>Event Contributor</option>
            <option>Photoshoot Assistant</option>
            <option>Tutor Assistant</option>
            <option>Data Entry</option>
          </select>
        `;
      } else if (category === "events") {
        options = `
          <label for="workerSubSkill">Select Event Type:</label>
          <select id="workerSubSkill">
            <option>College Fest</option>
            <option>Functions</option>
            <option>Marriage</option>
            <option>Birthday Party</option>
            <option>Corporate Event</option>
            <option>Festival Celebration</option>
          </select>
        `;
      }

      selectedCategory = category;
      document.getElementById('workerSubOptions').innerHTML = options;
    }

    function submitWorkerSkills() {
      if (selectedCategory === "") {
        alert("Please select a skill category!");
        return;
      }

      selectedSub = document.getElementById("workerSubSkill")?.value || "";

      document.getElementById('workerSkillsSection').style.display = 'none';
      document.getElementById('alertSection').style.display = 'block';

      let alertMessage = `
        <div class="alert-box">
          <p>âœ… Worker registration successful!</p>
          <p>Selected skill: <b>${selectedCategory} - ${selectedSub}</b></p>
          <p>ðŸ“§ Further opportunities will be sent to your registered email: <b>${userEmail}</b>.</p>
        </div>
      `;
      document.getElementById("alerts").innerHTML = alertMessage;
    }

    function submitCustomer() {
      userEmail = document.getElementById('customerEmail').value;
      const name = document.getElementById('customerName').value;
      const age = document.getElementById('customerAge').value;
      const contact = document.getElementById('customerContact').value;

      if (!userEmail || !name || !age || !contact) {
        alert("Please fill in all required fields.");
        return;
      }

      if (!validateEmail(userEmail)) {
        alert("Please enter a valid email address.");
        return;
      }

      if (!validateContact(contact)) {
        alert("Please enter a valid 10-digit phone number.");
        return;
      }

      document.getElementById('customerSignupSection').style.display = 'none';
      document.getElementById('customerServicesSection').style.display = 'block';
    }

    function showCustomerSubOptions() {
      const category = document.getElementById('customerServiceCategory').value;
      let options = "";

      if (category === "teaching") {
        options = `
          <label for="customerSubService">Select Subject:</label>
          <select id="customerSubService">
            <option>Biology</option>
            <option>Physics</option>
            <option>Chemistry</option>
            <option>Story Teller</option>
            <option>Maths</option>
            <option>Aptitude</option>
            <option>English</option>
            <option>History</option>
          </select>
        `;
      } else if (category === "parttime") {
        options = `
          <label for="customerSubService">Select Job Type:</label>
          <select id="customerSubService">
            <option>Delivery Boy</option>
            <option>Mehndi Designer</option>
            <option>Event Contributor</option>
            <option>Photoshoot Assistant</option>
            <option>Tutor Assistant</option>
            <option>Data Entry</option>
          </select>
        `;
      } else if (category === "events") {
        options = `
          <label for="customerSubService">Select Event Type:</label>
          <select id="customerSubService">
            <option>College Fest</option>
            <option>Functions</option>
            <option>Marriage</option>
            <option>Birthday Party</option>
            <option>Corporate Event</option>
            <option>Festival Celebration</option>
          </select>
        `;
      }

      selectedCategory = category;
      document.getElementById('customerSubOptions').innerHTML = options;
    }

    function submitCustomerServices() {
      if (selectedCategory === "") {
        alert("Please select a service category!");
        return;
      }

      selectedSub = document.getElementById("customerSubService")?.value || "";

      document.getElementById('customerServicesSection').style.display = 'none';
      document.getElementById('alertSection').style.display = 'block';

      let alertMessage = `
        <div class="alert-box">
          <p>âœ… Customer registration successful!</p>
          <p>Selected service: <b>${selectedCategory} - ${selectedSub}</b></p>
          <p>ðŸ“§ Service-related updates will be sent to your registered email: <b>${userEmail}</b>.</p>
        </div>
      `;
      document.getElementById("alerts").innerHTML = alertMessage;
    }
  </script>
</body>
</html>


const express = require('express');
const mongoose = require('mongoose');
const multer = require('multer');
const cors = require('cors');
const path = require('path');
const dotenv = require('dotenv');

// Load environment variables from .env file
dotenv.config();

const app = express();
const port = process.env.PORT || 5000;

// Middleware
app.use(cors({ origin: 'http://localhost' })); // Allow frontend origin
app.use(express.json()); // Parse JSON bodies
app.use('/uploads', express.static('uploads')); // Serve uploaded files

// MongoDB Connection
mongoose.connect(process.env.MONGO_URI, {
  useNewUrlParser: true,
  useUnifiedTopology: true,
})
  .then(() => console.log('MongoDB connected'))
  .catch(err => console.error('MongoDB connection error:', err));

// Multer setup for file uploads
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    cb(null, 'uploads/');
  },
  filename: (req, file, cb) => {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1e9);
    cb(null, `${uniqueSuffix}-${file.originalname}`);
  },
});

const upload = multer({
  storage,
  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB limit
  fileFilter: (req, file, cb) => {
    const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png'];
    if (allowedTypes.includes(file.mimetype)) {
      cb(null, true);
    } else {
      cb(new Error('Invalid file type. Only PDF, JPG, and PNG are allowed.'));
    }
  },
});

// Mongoose Schemas
const workerSchema = new mongoose.Schema({
  name: { type: String, required: true },
  email: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  age: { type: Number, required: true },
  education: { type: String, required: true },
  idProof: { type: String, required: true },
  resume: { type: String, required: true },
  contact: { type: String, required: true },
  skillCategory: { type: String, required: true },
  subSkill: { type: String, required: true },
  role: { type: String, default: 'worker' },
});

const customerSchema = new mongoose.Schema({
  name: { type: String, required: true },
  email: { type: String, required: true, unique: true },
  age: { type: Number, required: true },
  contact: { type: String, required: true },
  serviceCategory: { type: String, required: true },
  subService: { type: String, required: true },
  role: { type: String, default: 'customer' },
});

const Worker = mongoose.model('Worker', workerSchema);
const Customer = mongoose.model('Customer', customerSchema);

// Validation Functions
const validateEmail = (email) => {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
};

const validateContact = (contact) => {
  const re = /^\d{10}$/;
  return re.test(contact);
};

// API Endpoints

// Worker Registration
app.post('/api/worker', upload.fields([{ name: 'idProof' }, { name: 'resume' }]), async (req, res) => {
  try {
    const {
      name,
      email,
      password,
      age,
      education,
      contact,
      skillCategory,
      subSkill,
    } = req.body;

    // Validation
    if (!name || name.trim().length === 0) {
      return res.status(400).json({ error: 'Name is required' });
    }
    if (!validateEmail(email)) {
      return res.status(400).json({ error: 'Invalid email address' });
    }
    if (!password || password.length < 8) {
      return res.status(400).json({ error: 'Password must be at least 8 characters' });
    }
    if (!age || parseInt(age) < 18) {
      return res.status(400).json({ error: 'Age must be at least 18' });
    }
    if (!['12_pass', 'graduate', 'postgraduate'].includes(education)) {
      return res.status(400).json({ error: 'Education must be at least 10+2' });
    }
    if (!validateContact(contact)) {
      return res.status(400).json({ error: 'Invalid 10-digit phone number' });
    }
    if (!req.files.idProof || !req.files.resume) {
      return res.status(400).json({ error: 'ID proof and resume are required' });
    }
    if (!skillCategory || !subSkill) {
      return res.status(400).json({ error: 'Skill category and sub-skill are required' });
    }

    const worker = new Worker({
      name,
      email,
      password, // In production, hash the password using bcrypt
      age,
      education,
      idProof: req.files.idProof[0].path,
      resume: req.files.resume[0].path,
      contact,
      skillCategory,
      subSkill,
    });

    await worker.save();
    res.status(200).json({ message: 'Worker registered successfully' });
  } catch (error) {
    console.error('Error registering worker:', error);
    if (error.code === 11000) {
      res.status(400).json({ error: 'Email already registered' });
    } else if (error.message.includes('Invalid file type')) {
      res.status(400).json({ error: error.message });
    } else {
      res.status(500).json({ error: 'Server error' });
    }
  }
});

// Customer Registration
app.post('/api/customer', async (req, res) => {
  try {
    const {
      name,
      email,
      age,
      contact,
      serviceCategory,
      subService,
    } = req.body;

    // Validation
    if (!name || name.trim().length === 0) {
      return res.status(400).json({ error: 'Name is required' });
    }
    if (!validateEmail(email)) {
      return res.status(400).json({ error: 'Invalid email address' });
    }
    if (!age || parseInt(age) < 18) {
      return res.status(400).json({ error: 'Age must be at least 18' });
    }
    if (!validateContact(contact)) {
      return res.status(400).json({ error: 'Invalid 10-digit phone number' });
    }
    if (!serviceCategory || !subService) {
      return res.status(400).json({ error: 'Service category and sub-service are required' });
    }

    const customer = new Customer({
      name,
      email,
      age,
      contact,
      serviceCategory,
      subService,
    });

    await customer.save();
    res.status(200).json({ message: 'Customer registered successfully' });
  } catch (error) {
    console.error('Error registering customer:', error);
    if (error.code === 11000) {
      res.status(400).json({ error: 'Email already registered' });
    } else {
      res.status(500).json({ error: 'Server error' });
    }
  }
});

// Start Server
app.listen(port, () => {
  console.log(`Server running on http://localhost:${port}`);
});
